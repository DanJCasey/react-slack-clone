(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{11:function(e,t,n){e.exports={component:"UserList_component__3GZEl",hint:"UserList_hint__3yHVY",online:"UserList_online__1rVDK"}},13:function(e){e.exports={a:"2.1.0"}},14:function(e,t,n){e.exports={component:"MessageList_component__RRQtg",empty:"MessageList_empty__3jmJH"}},15:function(e,t,n){e.exports={component:"Message_component__2AL7A",online:"Message_online__1JFDJ"}},16:function(e,t,n){e.exports={container:"FileInput_container___cTTh",component:"FileInput_component__1yO-6"}},21:function(e,t,n){e.exports={component:"UserHeader_component__3D56q",pulse:"UserHeader_pulse__1oLd-"}},23:function(e,t,n){e.exports={component:"CreateMessageForm_component__x3Q4y"}},24:function(e,t,n){e.exports={component:"RoomList_component__2GFbC"}},25:function(e,t,n){e.exports={component:"RoomHeader_component__hhikX"}},26:function(e,t,n){e.exports={component:"CreateRoomForm_component__1CypN"}},27:function(e,t,n){e.exports={component:"WelcomeScreen_component__2Ivt5",pulse:"WelcomeScreen_pulse__YJGy0"}},28:function(e,t,n){e.exports={component:"JoinRoomScreen_component__TSpRL",pulse:"JoinRoomScreen_pulse__1oJRx"}},29:function(e,t,n){e.exports=n(66)},40:function(e,t,n){},5:function(e,t,n){e.exports={component:"TypingIndicator_component__3H9UA",dots:"TypingIndicator_dots__3LGVD","ball-beat":"TypingIndicator_ball-beat__lC0tN"}},66:function(e,t,n){"use strict";n.r(t);var a=n(12),o=n(1),r=n(3),s=n(7),c=n(8),i=n(10),l=n(9),u=n(4),m=n(0),d=n.n(m),p=n(20),f=n.n(p),v=n(13),g=(n(40),n(21)),h=n.n(g),E=function(e){var t=e.user,n=void 0===t?{}:t;return d.a.createElement("header",{className:h.a.component},d.a.createElement("img",{src:n.avatarURL||"data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7",alt:n.name}),d.a.createElement("div",null,d.a.createElement("h3",null,n.name),d.a.createElement("h5",null,n.id&&"@".concat(n.id))))},b=n(11),y=n.n(b),_=function(e){var t=e.room,n=(e.current,e.createConvo);e.removeUser;return d.a.createElement("ul",{className:y.a.component},t.users.map(function(e){return d.a.createElement("li",{key:e.id,className:"online"===e.presence.state?y.a.online:null,onClick:function(t){return n({user:e})},style:{order:"online"===e.presence.state&&-1}},d.a.createElement("img",{src:e.avatarURL,alt:e.name}),d.a.createElement("p",null,e.name))}),t.users.length<5?d.a.createElement("li",{className:y.a.hint},d.a.createElement("div",null,"Type ",d.a.createElement("span",null,"/invite <username>")," to invite")):null)},R=n(14),k=n.n(R),C=n(15),O=n.n(C),w=n(22),j=n.n(w);function L(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return Object(l.a)(this,n)}}var x=function(e){Object(i.a)(n,e);var t=L(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(c.a)(n,[{key:"componentDidMount",value:function(){this.props.link&&this.setState({src:this.props.link})}},{key:"render",value:function(){return this.state?{image:d.a.createElement("img",{controls:!0,src:this.state.src,alt:this.state.name}),video:d.a.createElement("video",{controls:!0,src:this.state.src}),audio:d.a.createElement("audio",{controls:!0,src:this.state.src}),file:d.a.createElement("a",{href:this.state.src,download:!0},"Download File")}[this.props.type]:null}}]),n}(d.a.Component),I=function(e){var t=e.user,n=e.createConvo;return function(e){return e.sender?d.a.createElement("li",{key:e.id,className:O.a.component},d.a.createElement("img",{onClick:function(t){return n({user:e.sender})},src:e.sender.avatarURL,alt:e.sender.name}),d.a.createElement("div",null,d.a.createElement("span",{className:e.sender.id===t.id||e.sender.presence&&"online"===e.sender.presence.state?O.a.online:null},"".concat(e.sender.name," | ").concat((a=e.createdAt,o=new Date(a),r=o.getMinutes(),"".concat(o.getHours(),":").concat(r<10?"0"+r:r)))),d.a.createElement("p",null,d.a.createElement(j.a,{properties:{target:"_blank"}},e.text)),e.attachment?d.a.createElement(x,{user:t,link:e.attachment.link,type:e.attachment.type}):null)):null;var a,o,r}},A=d.a.createElement("div",{className:k.a.empty},d.a.createElement("span",{role:"img","aria-label":"post"},"\ud83d\udcdd"),d.a.createElement("h2",null,"No Messages Yet"),d.a.createElement("p",null,"Be the first to post in this room or invite someone to join the room")),S=function(e){var t=e.messages,n=void 0===t?{}:t,a=e.user,o=e.createConvo;return d.a.createElement("ul",{id:"messages",className:k.a.component},Object.keys(n).length>0?d.a.createElement("wrapper-",null,Object.keys(n).reverse().map(function(e){return I({user:a,createConvo:o})(n[e])})):A)},U=n(5),N=n.n(U),T=d.a.createElement("div",{className:N.a.dots},[0,1,2].map(function(e){return d.a.createElement("div",{key:e})})),M=function(e){var t=e.typing,n=void 0===t?{}:t;return Object.keys(n).length?d.a.createElement("div",{className:N.a.component},d.a.createElement("div",null,T),d.a.createElement("div",null,"".concat(Object.keys(n).slice(0,2).join(" and ")," is typing"))):null},H=n(23),F=n.n(H),J=n(16),P=n.n(J),B=function(e){var t=e.state,n=t.user,a=t.message,o=t.room;return o.id?d.a.createElement("div",{className:P.a.container},d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#attach"})),d.a.createElement("input",{className:P.a.component,type:"file",onChange:function(e){var t=e.target.files[0];t&&n.sendMessage({text:a||t.name,roomId:o.id,attachment:{name:t.name.replace(/[^A-Za-z0-9._-]/g,"--"),file:t}})}})):null},D=function(e){var t=e.state,n=t.user,a=void 0===n?{}:n,o=t.room,r=void 0===o?{}:o,s=t.message,c=void 0===s?"":s,i=e.actions.runCommand;return r.id?d.a.createElement("form",{className:F.a.component,onSubmit:function(e){e.preventDefault();var t=e.target[0].value.trim();0!==t.length&&(e.target[0].value="",t.startsWith("/")?i(t.slice(1)):a.sendMessage({text:t,roomId:r.id}))}},d.a.createElement("input",{placeholder:"Type a Message..",onInput:function(e){return a.isTypingIn({roomId:r.id})}}),d.a.createElement(B,{state:{user:a,room:r,message:c}}),d.a.createElement("button",{type:"submit"},d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#send"})))):null},q=n(24),G=n.n(q),W=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=e.readCursor({roomId:t.id});return a&&Object.keys(n).filter(function(e){return e>a.position}).length||void 0},Q=function(e){var t=e.rooms,n=void 0===t?[]:t,a=e.user,o=e.messages,r=e.current,s=e.typing,c=e.actions;return d.a.createElement("ul",{className:G.a.component},n.map(function(e){var t,n=Object.keys(o[e.id]||{}),i=n.length>0&&o[e.id][n.pop()],l=e.users.find(function(e){return e.id!==a.id}),u=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=W(e,t,n)||0,o=Object.keys(n).pop()||0;return-1*(10*a+parseInt(o))}(a,e,o[e.id]),m=W(a,e,o[e.id]);return d.a.createElement("li",{key:e.id,disabled:e.id===r.id,onClick:function(t){return c.joinRoom(e)},style:{order:u}},e.name.match(a.id)&&l?d.a.createElement("img",{src:l.avatarURL,alt:l.id}):(t=e.isPrivate?"lock":"public",d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#".concat(t)}))),d.a.createElement("col-",null,d.a.createElement("p",null,e.name.replace(a.id,"")),d.a.createElement("span",null,i&&i.text)),e.id!==r.id&&m?d.a.createElement("label",null,m):Object.keys(s[e.id]||{}).length>0?d.a.createElement("div",{className:U.dots},[0,1,2].map(function(e){return d.a.createElement("div",{key:e})})):null)}))},V=n(25),Y=n.n(V),z=function(e){var t=e.state,n=t.room,a=t.user,o=t.sidebarOpen,r=t.userListOpen,s=e.actions,c=s.setSidebar,i=s.setUserList;return d.a.createElement("header",{className:Y.a.component},d.a.createElement("button",{onClick:function(e){return c(!o)}},d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#menu"}))),d.a.createElement("h1",null,n.name&&n.name.replace(a.id,"")),n.users&&d.a.createElement("div",{onClick:function(e){return i(!r)}},d.a.createElement("span",null,n.users.length),d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#members"}))))},Z=n(26),K=n.n(Z),X=function(e){var t=e.submit;return d.a.createElement("form",{className:K.a.component,onSubmit:function(e){e.preventDefault(),t({name:e.target[0].value,private:e.target.elements[2].checked}),e.target[0].value=""}},d.a.createElement("input",{placeholder:"Create a Room",type:"text",required:!0}),d.a.createElement("button",null,d.a.createElement("input",{type:"checkbox"}),d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#lock"}))),d.a.createElement("button",{type:"submit"},d.a.createElement("svg",null,d.a.createElement("use",{xlinkHref:"index.svg#add"}))))},$=n(27),ee=n.n($),te=function(){return d.a.createElement("section",null,d.a.createElement("div",{className:ee.a.component},d.a.createElement("span",{role:"img","aria-label":"post"},d.a.createElement("svg",{viewBox:"0 0 59 80"},d.a.createElement("g",null,d.a.createElement("path",{d:"M48.417 49.444L38.585 73.229 36.012 71.394 41.802 56.726 31.211 59.519C31.211 59.519 26.022 42.42 26.513 30.837 26.218 22.744 27.644 16.96 30.167 13.6 34.274 8.408 42.099 3.953 49.793 7.645 54.701 9.869 57.658 13.889 58.107 17.824 59.479 34.859 38.498 41.817 38.498 41.817L38.085 38.191C38.085 38.191 44.945 35.464 49.105 29.553 53.266 23.643 51.245 15.88 46.569 14.464 42.061 13.577 37.34 18.757 36.516 27.966 34.721 41.776 39.393 52.006 39.393 52.006L48.417 49.444M0 62.396L15.402 74.372 16.522 71.783 8.26 65.71 16.853 63.305C16.853 63.305 10.998 47.535 10.597 32.251 10.229 27.354 9.896 11.684 15.924 8.975 16.976 7.213 18.743 5.903 18.743 5.903 18.743 5.903 3.467 4.584 4.184 32.453 5.706 51.166 9.451 59.821 9.451 59.821L0 62.396"}),d.a.createElement("path",{d:"M29.91,61.761 L38.969,59.263 L30.045,80 L11.998,66.538 L19.098,64.644 C19.098,64.644 3.276,20.694 21.128,5.095 C32.325,-3.789 43.164,3.999 42.965,4.872 C40.203,4.812 37.842,5.844 37.842,5.844 C37.842,5.844 31.789,3.265 27.475,12.503 C23.719,20.705 22.048,34.474 29.91,61.761"}),d.a.createElement("path",{d:"M41.806,17.606 C42.599,24.356 38.244,27.206 38.244,27.206 L37.819,30.659 C37.819,30.659 47.709,25.549 45.669,15.819 C44.566,15.913 42.212,17.242 41.806,17.606"})))),d.a.createElement("p",null,"Authenticating, subscribing to rooms",d.a.createElement("br",null),"and fetching messages.")))},ne=n(28),ae=n.n(ne),oe=function(){return d.a.createElement("section",null,d.a.createElement("div",{className:ae.a.component},d.a.createElement("span",{role:"img","aria-label":"post"},d.a.createElement("svg",{viewBox:"0 0 59 80"},d.a.createElement("g",null,d.a.createElement("path",{d:"M48.417 49.444L38.585 73.229 36.012 71.394 41.802 56.726 31.211 59.519C31.211 59.519 26.022 42.42 26.513 30.837 26.218 22.744 27.644 16.96 30.167 13.6 34.274 8.408 42.099 3.953 49.793 7.645 54.701 9.869 57.658 13.889 58.107 17.824 59.479 34.859 38.498 41.817 38.498 41.817L38.085 38.191C38.085 38.191 44.945 35.464 49.105 29.553 53.266 23.643 51.245 15.88 46.569 14.464 42.061 13.577 37.34 18.757 36.516 27.966 34.721 41.776 39.393 52.006 39.393 52.006L48.417 49.444M0 62.396L15.402 74.372 16.522 71.783 8.26 65.71 16.853 63.305C16.853 63.305 10.998 47.535 10.597 32.251 10.229 27.354 9.896 11.684 15.924 8.975 16.976 7.213 18.743 5.903 18.743 5.903 18.743 5.903 3.467 4.584 4.184 32.453 5.706 51.166 9.451 59.821 9.451 59.821L0 62.396"}),d.a.createElement("path",{d:"M29.91,61.761 L38.969,59.263 L30.045,80 L11.998,66.538 L19.098,64.644 C19.098,64.644 3.276,20.694 21.128,5.095 C32.325,-3.789 43.164,3.999 42.965,4.872 C40.203,4.812 37.842,5.844 37.842,5.844 C37.842,5.844 31.789,3.265 27.475,12.503 C23.719,20.705 22.048,34.474 29.91,61.761"}),d.a.createElement("path",{d:"M41.806,17.606 C42.599,24.356 38.244,27.206 38.244,27.206 L37.819,30.659 C37.819,30.659 47.709,25.549 45.669,15.819 C44.566,15.913 42.212,17.242 41.806,17.606"})))),d.a.createElement("p",null,"Join a room, create a room or click on a user avatar and start a conversation.")))},re=n(17),se=n.n(re),ce="v1:us1:05f46048-3763-4482-9cfe-51ff327c3f29",ie=function(e,t){return"https://chatkit-demo-server.herokuapp.com/token?user=".concat(e,"&token=").concat(t)},le=function(e,t){e.state;var n=e.actions,a=t.id,o=t.token;return new se.a.ChatManager({tokenProvider:new se.a.TokenProvider({url:ie(a,o)}),instanceLocator:ce,userId:a}).connect({onUserStartedTyping:n.isTyping,onUserStoppedTyping:n.notTyping,onAddedToRoom:n.subscribeToRoom,onRemovedFromRoom:n.removeRoom,onPresenceChanged:n.setUserPresence}).then(function(e){Promise.all(e.rooms.map(function(t){return e.subscribeToRoom({roomId:t.id,hooks:{onMessage:n.addMessage}})})).then(function(t){n.setUser(e),e.rooms.length>0&&n.joinRoom(e.rooms[0])})}).catch(function(e){return console.log("Error on connection",e)})};function ue(e){var t=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,a=Object(u.a)(e);if(t){var o=Object(u.a)(this).constructor;n=Reflect.construct(a,arguments,o)}else n=a.apply(this,arguments);return Object(l.a)(this,n)}}var me=function(e){Object(i.a)(n,e);var t=ue(n);function n(){var e;Object(s.a)(this,n);for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return(e=t.call.apply(t,[this].concat(i))).state={user:{},room:{},messages:{},typing:{},sidebarOpen:!1,userListOpen:window.innerWidth>1e3},e.actions={setSidebar:function(t){return e.setState({sidebarOpen:t})},setUserList:function(t){return e.setState({userListOpen:t})},setUser:function(t){return e.setState({user:t})},setRoom:function(t){e.setState({room:t,sidebarOpen:!1}),e.actions.scrollToEnd()},removeRoom:function(t){return e.setState({room:{}})},joinRoom:function(t){e.actions.setRoom(t),e.actions.subscribeToRoom(t),e.state.messages[t.id]&&e.actions.setCursor(t.id,Object.keys(e.state.messages[t.id]).pop())},subscribeToRoom:function(t){return!e.state.user.roomSubscriptions[t.id]&&e.state.user.subscribeToRoom({roomId:t.id,hooks:{onMessage:e.actions.addMessage}})},createRoom:function(t){return e.state.user.createRoom(t).then(e.actions.joinRoom)},createConvo:function(t){if(t.user.id!==e.state.user.id){var n=e.state.user.rooms.find(function(n){return n.name===t.user.id+e.state.user.id||n.name===e.state.user.id+t.user.id});n?e.actions.joinRoom(n):e.actions.createRoom({name:e.state.user.id+t.user.id,addUserIds:[t.user.id],private:!0})}},addUserToRoom:function(t){var n=t.userId,a=t.roomId,o=void 0===a?e.state.room.id:a;return e.state.user.addUserToRoom({userId:n,roomId:o}).then(e.actions.setRoom)},removeUserFromRoom:function(t){var n=t.userId,a=t.roomId,o=void 0===a?e.state.room.id:a;return n===e.state.user.id?e.state.user.leaveRoom({roomId:o}):e.state.user.removeUserFromRoom({userId:n,roomId:o}).then(e.actions.setRoom)},setCursor:function(t,n){return e.state.user.setReadCursor({roomId:t,position:parseInt(n)}).then(function(t){return e.forceUpdate()})},addMessage:function(t){var n=t.room.id,a=t.id;(e.setState(function(e){return{messages:Object(r.a)({},e.messages,Object(o.a)({},n,Object(r.a)({},e.messages[n],Object(o.a)({},a,t))))}}),n===e.state.room.id)&&(((e.state.user.readCursor({roomId:n})||{}).position||0)<a&&e.actions.setCursor(n,a),e.actions.scrollToEnd());e.actions.showNotification(t)},runCommand:function(t){var n={invite:function(t){var n=Object(a.a)(t,1)[0];return e.actions.addUserToRoom({userId:n})},remove:function(t){var n=Object(a.a)(t,1)[0];return e.actions.removeUserFromRoom({userId:n})},leave:function(t){Object(a.a)(t,1)[0];return e.actions.removeUserFromRoom({userId:e.state.user.id})}},o=t.split(" ")[0],r=t.split(" ").slice(1),s=n[o];s&&s(r).catch(console.log)},scrollToEnd:function(e){return setTimeout(function(){var e=document.querySelector("#messages");e&&(e.scrollTop=1e5)},0)},isTyping:function(t,n){return e.setState(function(e){return{typing:Object(r.a)({},e.typing,Object(o.a)({},t.id,Object(r.a)({},e.typing[t.id],Object(o.a)({},n.id,!0))))}})},notTyping:function(t,n){return e.setState(function(e){return{typing:Object(r.a)({},e.typing,Object(o.a)({},t.id,Object(r.a)({},e.typing[t.id],Object(o.a)({},n.id,!1))))}})},setUserPresence:function(){return e.forceUpdate()},showNotification:function(t){"Notification"in window&&e.state.user.id&&e.state.user.id!==t.senderId&&"hidden"===document.visibilityState&&new Notification("New Message from ".concat(t.sender.id),{body:t.text,icon:t.sender.avatarURL}).addEventListener("click",function(n){e.actions.joinRoom(t.room),window.focus()})}},e}return Object(c.a)(n,[{key:"componentDidMount",value:function(){var e=this;"Notification"in window&&Notification.requestPermission(),fe?le(this,JSON.parse(fe)):fetch("https://chatkit-demo-server.herokuapp.com/auth",{method:"POST",body:JSON.stringify({code:pe})}).then(function(e){return e.json()}).then(function(t){t.version=v.a,window.localStorage.setItem("chatkit-user",JSON.stringify(t)),window.history.replaceState(null,null,window.location.pathname),le(e,t)})}},{key:"render",value:function(){var e=this.state,t=e.user,n=e.room,a=e.messages,o=e.typing,r=e.sidebarOpen,s=e.userListOpen,c=this.actions,i=c.createRoom,l=c.createConvo,u=c.removeUserFromRoom;return d.a.createElement("main",null,d.a.createElement("aside",{"data-open":r},d.a.createElement(E,{user:t}),d.a.createElement(Q,{user:t,rooms:t.rooms,messages:a,typing:o,current:n,actions:this.actions}),t.id&&d.a.createElement(X,{submit:i})),d.a.createElement("section",null,d.a.createElement(z,{state:this.state,actions:this.actions}),n.id?d.a.createElement("row-",null,d.a.createElement("col-",null,d.a.createElement(S,{user:t,messages:a[n.id],createConvo:l}),d.a.createElement(M,{typing:o[n.id]}),d.a.createElement(D,{state:this.state,actions:this.actions})),s&&d.a.createElement(_,{room:n,current:t.id,createConvo:l,removeUser:u})):t.id?d.a.createElement(oe,null):d.a.createElement(te,null)))}}]),n}(d.a.Component);window.localStorage.getItem("chatkit-user")&&!window.localStorage.getItem("chatkit-user").match(v.a)&&window.localStorage.clear();var de,pe=new URLSearchParams(window.location.search.slice(1)).get("code"),fe=window.localStorage.getItem("chatkit-user");fe||pe?f.a.render(d.a.createElement(me,null),document.querySelector("#root")):(de="".concat("https://chatkit-demo-server.herokuapp.com","/success?url=").concat(window.location.href.split("?")[0]),window.location="".concat("https://github.com/login/oauth/authorize","?scope=user:email&client_id=").concat("20cdd317000f92af12fe","&redirect_uri=").concat(de))}},[[29,2,1]]]);
//# sourceMappingURL=main.47183b5d.chunk.js.map